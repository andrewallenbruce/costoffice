tidytable::drop_na() |>
knitr::kable()
search_datasets(specialty = "vascular surgery") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty, state, tidytable::starts_with("new_")) |>
tidytable::summarise(avg_price_mode = mean(new_price_mode),
avg_copay_mode = mean(new_copay_mode),
.by = c(specialty, state, new_code)) |>
tidytable::select(-new_code) |>
tidytable::drop_na() |>
knitr::kable()
search_datasets(specialty = "cardiology") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty,
state,
tidytable::starts_with("est_")) |>
tidytable::summarise(avg_price_mode = round(mean(est_price_mode), 2),
avg_copay_mode = round(mean(est_copay_mode), 2),
.by = c(specialty,
state,
est_code)) |>
tidytable::select(-est_code) |>
tidytable::drop_na() |>
knitr::kable()
search_datasets(specialty = "vascular surgery") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty,
state,
tidytable::starts_with("new_")) |>
tidytable::summarise(avg_price_mode = mean(new_price_mode),
avg_copay_mode = mean(new_copay_mode),
.by = c(specialty,
state,
new_code)) |>
tidytable::drop_na() |>
knitr::kable()
search_datasets(specialty = "vascular surgery") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty,
state,
tidytable::starts_with("new_")) |>
tidytable::summarise(avg_price_mode = round(mean(new_price_mode), 2),
avg_copay_mode = round(mean(new_copay_mode), 2),
.by = c(specialty,
state,
new_code)) |>
tidytable::drop_na() |>
knitr::kable()
search_datasets()
cardio <- search_datasets(specialty = "cardiology") |>
download_dataset()
nrow(cardio)
ncol(cardio)
lobstr::obj_size(cardio)
cardio |>
tidytable::slice_sample(n = 10) |>
knitr::kable()
data("zipcode_db")
zipcode_db |>
tidytable::slice_head() |>
knitr::kable()
search_datasets(specialty = "vascular surgery") |>
download_dataset() |>
tidytable::slice_sample(n = 10) |>
use_zipcoder() |>
knitr::kable()
search_datasets(specialty = "vascular surgery") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty,
state,
tidytable::starts_with("new_")) |>
tidytable::summarise(avg_price_mode = round(mean(new_price_mode), 2),
avg_copay_mode = round(mean(new_copay_mode), 2),
.by = c(specialty,
state,
new_code)) |>
tidytable::drop_na() |>
knitr::kable()
search_datasets(specialty = "cardiology") |>
download_dataset() |>
use_zipcoder() |>
tidytable::select(specialty,
state,
tidytable::starts_with("est_")) |>
tidytable::summarise(avg_price_mode = round(mean(est_price_mode), 2),
avg_copay_mode = round(mean(est_copay_mode), 2),
.by = c(specialty,
state,
est_code)) |>
tidytable::drop_na() |>
knitr::kable()
gc()
devtools::build_rmd("README.Rmd")
devtools::build_site()
fledge::bump_version()
fledge::finalize_version(push = TRUE)
sd <- search_datasets()
sd
source("C:/Users/andyb/Desktop/costoffice/R/download_dataset.R")
devtools::load_all(".")
sd <- search_datasets()
devtools::load_all(".")
sd <- search_datasets()
class(sd)
sd$specialty
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd
sd |> tibble::tibble()
sd <- sd |> tibble::tibble()
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
devtools::load_all(".")
sd <- search_datasets()
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
devtools::load_all(".")
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd[[csv_url]]
sd[["csv_url"]]
devtools::load_all(".")
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd <- sd |> tibble::tibble()
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
rlang::last_trace()
sd[[, "csv_url"]]
sd <- search_datasets()
sd[[, "csv_url"]]
sd[, "csv_url"]
devtools::load_all(".")
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd <- sd |> tibble::tibble()
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd <- search_datasets()
sd["csv_url"]
sd[, "csv_url"]
split(sd$specialty)
sd |> tidytable::select(specialty, csv_url)
sd |> tidytable::select(specialty, csv_url) |> split(specialty)
sd |> tidytable::select(specialty, csv_url) |> tidytable::group_split(specialty)
sd <- sd |> tidytable::select(specialty, csv_url) |> tidytable::group_split(specialty)
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
devtools::load_all(".")
sd <- search_datasets()
sd <- sd |> tidytable::select(specialty, csv_url) |> tidytable::group_split(specialty)
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
.datatable.aware <- TRUE
purrr::map_dfr(sd, ~costoffice::download_dataset(df = .x))
sd
class(sd)
tidytable::pmap_dfr(list(sd), ~costoffice::download_dataset)
tidytable::pmap_dfr(.l = sd, ~costoffice::download_dataset)
tidytable::pmap_dfr(.l = sd, .f = costoffice::download_dataset)
tidytable::pmap_dfr(.l = sd, .f = costoffice::download_dataset, ...)
tidytable::pmap_df(.l = sd, .f = costoffice::download_dataset)
tidytable::pmap_df(.l = sd, .f = download_dataset)
tidytable::pmap(.l = sd, .f = download_dataset)
tidytable::map(.x = sd, .f = download_dataset)
tidytable::map_dfr(sd, ~ costoffice::download_dataset(df = .x))
tidytable::map_dfr(sd, ~ costoffice::download_dataset)
sd |> tidytable::map_dfr(download_dataset)
sd[, "csv_url"]
sd <- search_datasets()
sd |> split(.$specialty) |> purrr::map(~download_dataset(data = .))
sd |> split(.$specialty) |> purrr::map(~download_dataset(df = .))
sd |> split(.$specialty) |> purrr::map(~download_dataset)
sd |> split(.$specialty)
sd |> tibble::tibble() |> split(.$specialty)
sd |> tibble::tibble()
sd |> tibble::tibble() |> split($specialty)
sd |> tibble::tibble() |> split(specialty)
split(sd$specialty)
sd <- sd |> tidytable::select(specialty, csv_url) |> tidytable::group_split(specialty)
sd |> tibble::tibble()
sd |> purrr::map(~download_dataset)
sd |> purrr::modify_at(c("specialty", "csv_url"), download_dataset)
sd
sd <- sd |> tidytable::select(csv_url) |> tidytable::group_split(specialty)
sd |> tidytable::select(csv_url) |> tidytable::group_split(csv_url)
sd <- search_datasets()
sd |> tidytable::select(csv_url) |> tidytable::group_split(csv_url)
sd <- sd |> tidytable::select(csv_url) |> tidytable::group_split(csv_url)
sd |> purrr::map(~tidytable::fread)
sd |> purrr::map_df(~tidytable::fread)
sd |> purrr::map_df(tidytable::fread)
sd
sd <- search_datasets()
sd <- sd |> tidytable::select(csv_url)
sd |> purrr::map_dfr(tidytable::fread)
sd
sd |> as.vector()
sd |> as.vector() |> purrr::map_dfr(tidytable::fread)
sd |> as.string()
sd |> xtable::as.string()
sd |> xtable::string()
sd |> as.character()
sd |> as.character() |> purrr::map_dfr(tidytable::fread)
sd |> as.character() |> purrr::map_dfr(tidytable::fread) |> dplyr::glimpse()
sd |> as.list()
sd |> as.list() |> purrr::map(tidytable::fread)
d |> as.list() |> purrr::map(read.csv)
sd |> as.list() |> purrr::map(read.csv)
sd
d |> purrr::map(read.csv)
sd |> purrr::map(read.csv)
sd |> split(sd$csv_url)
sd |> split(sd$csv_url) |>  purrr::map(read.csv)
sd |>purrr::map_dfr(read_csv)
sd |>purrr::map_dfr(readr::read_csv)
gc()
sd
sd
sd <- search_datasets()
sd
search_datasets() |> tidytable::select(specialty, csv_url)
sd <- search_datasets() |> tidytable::select(specialty, csv_url)
sd <- search_datasets() |> tidytable::select(specialty, csv_url)
sd |>purrr::map2_dfr(readr::read_csv, .id = "specialty")
sd |>purrr::map_dfr(readr::read_csv, .id = "specialty")
sd |>purrr::map_dfr(readr::read_csv, .id = "source")
sd <- search_datasets() |> tidytable::select(csv_url)
sd |>purrr::map_dfr(readr::read_csv, .id = "source")
spec <- search_datasets()$specialty
spec
sd |>purrr::map_dfr(readr::read_csv, .id = "spec")
gc()
sd <- search_datasets() |> tidytable::select(specialty, csv_url)
sd
download_datasets <- function(df,
specialty,
url) {
results <- df |>
readr::read_csv(df$url) |>
tidytable::mutate(specialty = df$specialty, .before = zip_code)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
sd |>purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
sd$specialty
sd$csv_url
download_datasets <- function(df,
specialty,
url) {
results <- df |>
readr::read_csv(df$url) |>
tidytable::mutate(specialty = df$specialty)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
sd |>purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
download_datasets <- function(df,
specialty,
url) {
results <- df |>
readr::read_csv(url) |>
tidytable::mutate(specialty = specialty)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
download_datasets <- function(df = sd,
specialty = specialty,
url = csv_url) {
results <- df |>
readr::read_csv(url) |>
tidytable::mutate(specialty = specialty)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
download_datasets <- function(df = "sd",
specialty = "specialty",
url = "csv_url") {
results <- df |>
readr::read_csv(url) |>
tidytable::mutate(specialty = specialty)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
download_datasets <- function(df,
specialty,
url) {
results <- df |>
readr::read_csv({{ url }}) |>
tidytable::mutate(specialty = {{ specialty }}, .before = zip_code)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
sd |> purrr::map2_dfr(sd$specialty, sd$csv_url, download_datasets)
sd |> purrr::map2(specialty, csv_url, download_datasets) |> purrr::list_rbind()
download_datasets <- function(df,
specialty,
csv_url) {
results <- df |>
readr::read_csv({{ csv_url }}) |>
tidytable::mutate(specialty = {{ specialty }}, .before = zip_code)
# tidytable::select(zip_code,
#                   new_code = most_utilized_procedure_code_for_new_patient,
#                   new_price_min = min_medicare_pricing_for_new_patient,
#                   new_price_max = max_medicare_pricing_for_new_patient,
#                   new_price_mode = mode_medicare_pricing_for_new_patient,
#                   new_copay_min = min_copay_for_new_patient,
#                   new_copay_max = max_copay_for_new_patient,
#                   new_copay_mode = mode_copay_for_new_patient,
#                   est_code = most_utilized_procedure_code_for_established_patient,
#                   est_price_min = min_medicare_pricing_for_established_patient,
#                   est_price_max = max_medicare_pricing_for_established_patient,
#                   est_price_mode = mode_medicare_pricing_for_established_patient,
#                   est_copay_min = min_copay_for_established_patient,
#                   est_copay_max = max_copay_for_established_patient,
#                   est_copay_mode = mode_copay_for_established_patient) |>
# tidytable::mutate(specialty = y, .before = zip_code)
return(results)
}
sd |> purrr::map2(specialty, csv_url, download_datasets) |> purrr::list_rbind()
sd
sd |> purrr::map2("specialty", "csv_url", download_datasets) |> purrr::list_rbind()
purrr::map2(sd$specialty, sd$csv_url, ~download_datasets) |> purrr::list_rbind()
purrr::map2(sd$specialty, sd$csv_url, ~download_datasets)
purrr::map2_dfr(sd$specialty, sd$csv_url, ~download_datasets(specialty = .x, csv_url = .y))
sd |> purrr::map2_dfr(sd$specialty, sd$csv_url, ~download_datasets(specialty = .x, csv_url = .y))
purrr::pmap_dfr(list(sd, specialty, csv_url), ~download_datasets(df = .x, specialty = .y, csv_url = .z))
purrr::pmap_dfr(list(sd, sd$specialty, sd$csv_url), ~download_datasets(df = .x, specialty = .y, csv_url = .z))
data_frame(filename = sd$specialty) |> mutate(file_contents = map(filename, ~ read_csv(sd$csv_url)))
data_frame(filename = sd$specialty) |> dplyr::mutate(file_contents = purrr::map(filename, ~ readr::read_csv(sd$csv_url)))
dplyr::data_frame(filename = sd$specialty) |> dplyr::mutate(file_contents = purrr::map(filename, ~ readr::read_csv(sd$csv_url)))
devtools::load_all(".")
sd <- search_datasets() |> tidytable::select(specialty, csv_url)
devtools::load_all(".")
sd <- search_datasets() |> tidytable::select(specialty, csv_url)
devtools::load_all(".")
costoffice::search_datasets()
library(costoffice)
devtools::install_github("andrewallenbruce/costoffice")
sd <- costoffice::search_datasets() |> tidytable::select(specialty, csv_url)
sd
sd[1]
data <- dplyr::tibble(specialty = sd$specialty[1]) |>
dplyr::mutate(file_contents = purrr::map(specialty, ~ readr::read_csv(sd$csv_url[1])))
data
data |> tidyr::unnest(file_contents)
sd |> tidytable::slice_head(n = 5)
sd <- sd |> tidytable::slice_head(n = 5)
data <- dplyr::tibble(specialty = sd$specialty[1]) |>
dplyr::mutate(file_contents = purrr::map(specialty, ~ readr::read_csv(sd$csv_url[1])))
data |> tidyr::unnest(file_contents)
data <- dplyr::tibble(specialty = sd$specialty) |>
dplyr::mutate(file_contents = purrr::map(specialty, ~ readr::read_csv(sd$csv_url)))
data |> tidyr::unnest(file_contents)
data |> tidyr::unnest(file_contents) |>
tidytable::select(specialty,
zip_code,
new_code = most_utilized_procedure_code_for_new_patient,
new_price_min = min_medicare_pricing_for_new_patient,
new_price_max = max_medicare_pricing_for_new_patient,
new_price_mode = mode_medicare_pricing_for_new_patient,
new_copay_min = min_copay_for_new_patient,
new_copay_max = max_copay_for_new_patient,
new_copay_mode = mode_copay_for_new_patient,
est_code = most_utilized_procedure_code_for_established_patient,
est_price_min = min_medicare_pricing_for_established_patient,
est_price_max = max_medicare_pricing_for_established_patient,
est_price_mode = mode_medicare_pricing_for_established_patient,
est_copay_min = min_copay_for_established_patient,
est_copay_max = max_copay_for_established_patient,
est_copay_mode = mode_copay_for_established_patient)
gc()
remotes::install_github("petrbouchal/purrrow")
gc()
con <- DBI::dbConnect(duckdb::duckdb())
addiction <- search_datasets("addiction medicine") |> tidytable::select(csv_url)
devtools::load_all(".")
addiction <- costoffice::search_datasets("addiction medicine") |> tidytable::select(csv_url)
addiction
duckdb::duckdb_read_csv(conn = con, name = addiction_medicine, files = addiction)
costoffice::search_datasets("addiction medicine") |> tidytable::select(csv_url) |> unlist()
costoffice::search_datasets("addiction medicine") |> tidytable::select(csv_url) |> unlist(use.names = FALSE)
addiction <- costoffice::search_datasets("addiction medicine") |> tidytable::select(csv_url) |> unlist(use.names = FALSE)
duckdb::duckdb_read_csv(conn = con, name = addiction_medicine, files = addiction)
duckdb::duckdb_read_csv(conn = con, name = addiction, files = addiction)
View(con)
con <- DBI::dbConnect(duckdb::duckdb())
duckdb::duckdb_read_csv(conn = con, name = addiction, files = "https://data.cms.gov/provider-data/sites/default/files/resources/cc28605bc749af6ac14a045571988c26_1657569936/Addiction_Medicine.csv")
duckdb::duckdb_read_csv(conn = con, name = "addiction", files = "https://data.cms.gov/provider-data/sites/default/files/resources/cc28605bc749af6ac14a045571988c26_1657569936/Addiction_Medicine.csv")
DBI::dbListConnections()
DBI::dbDisconnect()
search_datasets(specialty = "cardiology") |>
download_dataset() |>
use_zipcoder()
devtools::load_all(".")
costoffice::search_datasets(specialty = "cardiology") |>
download_dataset() |>
use_zipcoder()
costoffice::search_datasets(specialty = "cardiology") |>
costoffice::download_dataset() |>
costoffice::use_zipcoder()
costoffice::search_datasets(specialty = "cardiology") |>
costoffice::download_dataset() |>
costoffice::use_zipcoder() |>
tidytable::drop_na()
costoffice::search_datasets(specialty = "cardiology") |>
costoffice::download_dataset() |>
costoffice::use_zipcoder() |>
tidytable::drop_na() |>
tidytable::select(specialty,
city,
state,
tidytable::starts_with("est_")) |>
tidytable::summarise(avg_price_mode = round(mean(est_price_mode), 2),
avg_copay_mode = round(mean(est_copay_mode), 2),
.by = c(specialty,
city,
state,
est_code)) |>
knitr::kable()
devtools::build_rmd("README.Rmd")
devtools::build_rmd("README.Rmd")
