)
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_light()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: https://fueleconomy.gov."
)
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "darkgray",
linewidth = 1) +
ggplot2::geom_point(color = "red", size = 3) +
ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_light()
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_light()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: https://fueleconomy.gov."
)
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: https://data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
devtools::build_rmd("README.Rmd")
remotes::install_github("hrbrmstr/statebins")
remotes::install_github("hrbrmstr/hrbrthemes")
gc()
est_cardio
library(statebins)
library(hrbrthemes)
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Cardiology: Established Patient Office Visit Costs",
palette = "OrRd",
direction = 1) +
ggplot2::labs(title = "Average Copays") +
theme_statebins()
library(statebins)
library(hrbrthemes)
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
palette = "PuBuGn",
direction = 1) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
palette = "PuBuGn",
direction = 1,
round = TRUE) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins(legend_position = "right")
library(statebins)
library(hrbrthemes)
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = TRUE) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins(legend_position = "right")
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = -1,
round = TRUE) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins(legend_position = "right")
library(statebins)
library(hrbrthemes)
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = -1,
round = TRUE) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins(legend_position = "right")
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = -1,
round = TRUE) +
ggplot2::labs(title = "Cardiology: Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = -1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
#ggplot2_scale_function = viridis::scale_fill_viridis,
direction = -1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
#ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
library(statebins)
library(hrbrthemes)
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins() +
theme_ipsum_rc()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
statebins(est_cardio,
value_col = "avg_copay_mode",
name = "Average Medicare Copays",
ggplot2_scale_function = viridis::scale_fill_viridis,
direction = 1,
round = FALSE) +
ggplot2::labs(title = "Established Patient Office Visit Costs: Cardiology") +
theme_statebins()
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "darkgray",
linewidth = 1) +
ggplot2::geom_point(color = "red", size = 3) +
ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_minimal()
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_minimal()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
devtools::load_all(".")
devtools::load_all(".")
download_datasets(2)
gc()
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "darkgray",
linewidth = 1) +
ggplot2::geom_point(color = "red", size = 3) +
#ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_minimal()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "black",
linewidth = 1) +
ggplot2::geom_point(color = "red", size = 3) +
#ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_minimal()
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_minimal()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(
forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "black",
linewidth = 1) +
ggplot2::geom_point(color = "black", size = 3) +
#ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_minimal()
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_minimal()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
p1 <- ggplot2::ggplot(est_cardio,
ggplot2::aes(
forcats::fct_reorder(state,
avg_price_mode,
median),
avg_price_mode)) +
ggplot2::geom_pointrange(
ggplot2::aes(ymin = avg_price_min,
ymax = avg_price_max),
size = 0,
colour = "black",
linewidth = 0.5) +
ggplot2::geom_point(color = "black", size = 3) +
#ggplot2::geom_point(shape = "circle open", size = 5, color = "red") +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Minimum, Mode, Maximum",
title = "",
subtitle = "Price Ranges by State") +
ggplot2::theme_minimal()
p2 <- ggplot2::ggplot(est_cardio, ggplot2::aes(forcats::fct_reorder(state,
avg_copay_mode,
median),
avg_copay_mode)) +
ggplot2::geom_pointrange(ggplot2::aes(ymin = avg_copay_min,
ymax = avg_copay_mode)) +
ggplot2::coord_flip() +
ggplot2::scale_y_continuous(labels = scales::label_dollar()) +
ggplot2::labs(
x = "",
y = "Average Minimum to Mode",
title = "",
subtitle = "Copay Ranges by State") +
ggplot2::theme_minimal()
library(patchwork)
(p1 + p2) +
plot_annotation(
title = "Cardiology: Established Patient Office Visit Costs",
caption = "Source: data.cms.gov/provider-data",
theme = ggplot2::theme(plot.title = ggplot2::element_text(size = 16))
)
devtools::build_rmd("README.Rmd")
fledge::bump_version()
fledge::finalize_version(push = TRUE)
html <- rvest::read_html("https://download.cms.gov/nppes/NPI_Files.html")
html <- rvest::read_html("https://download.cms.gov/nppes/NPI_Files.html")
devtools::install_github("inbo/inborutils")
remotes::install_github("inbo/INBOtheme")
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip")
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip")
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |> tibble::tibble()
list.files(path = path_zip)
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::select(filename)
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::select(filename) |> as.vector()
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::select(filename) |> as.vector() |> as.character()
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::select(filename) |> as.vector()
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble()
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = prettyunits::pretty_bytes(compressed_size))
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = as.character(prettyunits::pretty_bytes(compressed_size)))
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = prettyunits::pretty_bytes(compressed_size, style = "nopad"))
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = prettyunits::pretty_bytes(compressed_size, style = "6"))
zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = prettyunits::pretty_bytes(compressed_size, style = "nopad"),
uncompressed_size = prettyunits::pretty_bytes(uncompressed_size, style = "nopad"),
)
files_nppes <- zip::zip_list("C:/Users/andyb/Desktop/costoffice/zip/nppes.zip") |>
tibble::tibble() |>
dplyr::mutate(compressed_size = prettyunits::pretty_bytes(compressed_size, style = "nopad"),
uncompressed_size = prettyunits::pretty_bytes(uncompressed_size, style = "nopad"))
files_nppes
files_nppes$filename[[2]]
zip::unzip(files_nppes$filename[[2]])
arrow::read_csv_arrow(files_nppes$filename[[2]])
paste0("zip/", files_nppes$filename[[2]])
arrow::read_csv_arrow(paste0("zip/", files_nppes$filename[[2]]))
arrow::read_csv_arrow(paste0("zip/nppes.zip/", files_nppes$filename[[2]]))
zip::unzip(paste0("zip/nppes.zip/", files_nppes$filename[[2]]))
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[2]])
files_nppes$filename[[3]]
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[3]])
files_nppes$filename[[4]]
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[4]])
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[5]])
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[6]])
files_nppes$filename[[7]]
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[7]])
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[8]])
files_nppes$filename[[9]]
files_nppes$filename[[10]]
# npidata_pfile_20050523-20230312_fileheader.csv
# othername_pfile_20050523-20230312.csv
zip::unzip(zipfile = "zip/nppes.zip", files = files_nppes$filename[[1]])
names <- html |>
rvest::html_elements("li") |>
rvest::html_text2()
links <- html |>
rvest::html_elements("a") |>
rvest::html_attr("href")
files_nppes
arrow::read_csv_arrow("npidata_pfile_20050523-20230312.csv")
gc()
gc()
prefix <- "https://download.cms.gov/nppes"
df <- tibble::tribble(
~name,    ~link,
names[4], links[5],
names[5], links[6],
names[6], links[7],
names[7], links[8]) |>
dplyr::mutate(link = stringr::str_replace(link, ".", prefix)) |>
tidyr::separate_wider_delim(name, delim = " - ",
names = c("names", "desc", "date_format"),
too_few = "align_start", too_many = "merge") |>
tidyr::unite("description", names:desc, remove = TRUE, sep = " ")
df
df
gc()
arrow::open_dataset("npidata_pfile_20050523-20230312.csv")
arrow::open_dataset("npidata_pfile_20050523-20230312.csv", format = "csv")
